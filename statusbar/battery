#!/bin/sh

# Prints all batteries, their percentage remaining and an emoji corresponding
# to charge status (ğŸ”Œ for plugged up, ğŸ”‹ for discharging on battery, etc.).

#case $BLOCK_BUTTON in
#    3) pgrep -x dunst >/dev/null && notify-send "ğŸ”‹ Battery module" "ğŸ”‹: discharging
#ğŸ›‘: not charging
#â™»: stagnant charge
#ğŸ”Œ: charging
#âš¡: charged
#â—: battery very low!" ;;
#esac
#
## Loop through all attached batteries.
#for battery in /sys/class/power_supply/BAT?
#do
#	# Get its remaining capacity and charge status.
#	capacity=$(cat "$battery"/capacity)
#	status=$(sed "s/Discharging/ğŸ”‹/;s/Not charging/ğŸ›‘/;s/Charging/ğŸ”Œ/;s/Unknown/â™»ï¸/;s/Full/âš¡/" "$battery"/status)
#
#	# If it is discharging and 25% or less, we will add a â— as a warning.
#	 [ "$capacity" -le 25 ] && [ "$status" = "ğŸ”‹" ] && warn="â—"
#
#	printf "%s%s%s%%\n" "$status" "$warn" "$capacity"
#	unset warn
#done

#hash acpi || return 0
#minutes
#onl="$( acpi -V | grep "on-line" )"
charging="$(acpi | awk '{print $3}' | sed 's/\,//')"
charge="$(acpi | awk '{print $4}' | cut -b 1-2)"
remaining="$(acpi | awk '{print $5}' | cut -b 1-5)"

[ "$charging" = "Unknown" ] && emoji="ğŸ”Œ"
[ "$charging" = "Charging" ] && emoji="ğŸ—²ğŸ”‹"
[ "$charging" = "Discharging" ] && emoji="ğŸ”‹"

if [ "$charge" -le "30" ] && [ "$charging" = "Discharging" ]; then
     notify-send -u critical "System info" "Battery low. Last plugged in: $(cat /var/lib/upower/history-time-full-*.dat | awk '{ split($0, a," "); print a[1] }' | sed 's/^/echo "/; s/\([0-9]\{10\}\)/`date -d @\1`/; s/$/"/' | bash |
tail -n1) \n"
    emoji="â—ğŸ”‹"
fi

[ ! -z $remaining  ] && echo " $emoji $charge% ($remaining) "
[ -z $remaining ] && echo " $emoji $charge% "
